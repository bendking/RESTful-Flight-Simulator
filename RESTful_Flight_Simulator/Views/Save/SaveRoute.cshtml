@model RESTful_Flight_Simulator.Models.saveModel
@{
    ViewBag.Title = "SaveRoute";
}


<html>
<head>
    <link rel="stylesheet" type="text/css" href="~/Views/Shared/BackgroundImageCSSFile.css" />
    <script src="~/Views/Shared/SharedJSFile.js" type="text/javascript"></script>

</head>

<body>
    <img src="~/src/world-map.png" id="bg" alt="World Map">
    <canvas id="myCanvas"></canvas>

    <script type="text/javascript">
        document.title = "Live Route";

        var ip = '@Model.ip';
        var port = '@Model.port';
        var duration = parseInt('@Model.duration');
        var interval = parseInt('@Model.interval');
        var fileName = '@Model.fileName';

        var t=setInterval(start,1000.0 / interval);
        var i = 0;
        function start(){
            if (i/interval > duration) {
                alert("done!");
                clearInterval(t);
            }
            i++;
        var input = {
            vars: `${ip},${port},${fileName}`,

        };

        $.get("@Url.Action("GetCoordinatesAndSave", "data")", input).done(function (data) {

            var xmlDoc = $.parseXML(data),
            $xml = $(xmlDoc),
            Lon = $xml.find("Lon").text();
            Lat = $xml.find("Lat").text();


            if(Lon.localeCompare("EOF") == 0 || Lat.localeCompare("EOF") == 0) {
                // done
                alert("done!");
                clearInterval(t);
            } else {
                drawCircle(parseFloat(Lon), parseFloat(Lat), "myCanvas");
            }
        });
            }
    </script>

</body>
</html>